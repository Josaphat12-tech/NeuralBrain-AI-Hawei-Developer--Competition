{% extends "admin/base_dashboard.html" %}

{% block title %}Dashboard - NeuralBrain AI{% endblock %}

{% block extra_css %}
<style>
    #map {
        height: 500px;
        width: 100%;
        border-radius: 0 0 1rem 1rem;
    }

    .header-bar {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        margin-bottom: 2.5rem;
    }

    .stat-card {
        position: relative;
        overflow: hidden;
    }

    .stat-icon {
        position: absolute;
        top: 0;
        right: 0;
        padding: 1rem;
        opacity: 0.1;
        font-size: 4rem;
    }

    .stat-val {
        font-size: 2rem;
        font-weight: 700;
        margin: 0.5rem 0;
    }

    .stat-label {
        font-size: 0.75rem;
        color: var(--text-gray);
        text-transform: uppercase;
        font-weight: 700;
    }
</style>
{% endblock %}

{% block content %}
<!-- Header -->
<div class="responsive-header">
    <div style="margin-top: 2rem;">
        <h2 class="text-3xl">Global Dashboard</h2>
        <p class="text-gray" style="margin-top: 1rem; display: flex; align-items: center; gap: 0.5rem;">
            <span
                style="width: 8px; height: 8px; background-color: var(--accent-green); border-radius: 50%; display: inline-block;"
                class="animate-pulse"></span>
            <span>Real-time health monitoring systems operational</span>
        </p>
    </div>
    <div class="header-actions" style="text-align: right;">
        <p class="text-xs" style="color: var(--text-muted); font-weight: 700; text-transform: uppercase;">Last Synced
        </p>
        <p class="text-sm" style="color: var(--accent-blue); font-family: monospace;">
            {{ stats.latest_ingestion.timestamp if stats.latest_ingestion else 'Just now' }}
        </p>
    </div>
</div>

<!-- Top Stats Grid -->
<div class="grid-4 mb-6">
    <!-- Total Records -->
    <div class="glass p-6 stat-card">
        <div class="stat-icon">üåç</div>
        <h3 class="stat-label">Total Records</h3>
        <div style="display: flex; align-items: center;">
            <span class="stat-val">{{ stats.total_records }}</span>
            <span class="badge"
                style="background: rgba(34, 197, 94, 0.1); color: var(--accent-green); margin-left: 0.5rem;">+12%</span>
        </div>
    </div>

    <!-- Valid Records -->
    <div class="glass p-6 stat-card">
        <div class="stat-icon">‚úÖ</div>
        <h3 class="stat-label">Valid Data</h3>
        <div style="display: flex; align-items: center;">
            <span class="stat-val">{{ stats.valid_records }}</span>
            <span class="badge"
                style="background: rgba(59, 130, 246, 0.1); color: var(--accent-blue); margin-left: 0.5rem;">High
                Quality</span>
        </div>
    </div>

    <!-- Alerts -->
    <div class="glass p-6 stat-card">
        <div class="stat-icon">‚ö†Ô∏è</div>
        <h3 class="stat-label">Active Alerts</h3>
        <div style="display: flex; align-items: center;">
            <span class="stat-val">3</span>
            <span class="badge badge-red" style="margin-left: 0.5rem;" class="animate-pulse">CRITICAL</span>
        </div>
    </div>

    <!-- Data Quality -->
    <div class="glass p-6 stat-card">
        <div class="stat-icon">üìä</div>
        <h3 class="stat-label">Quality Score</h3>
        <div style="display: flex; align-items: center;">
            <span class="stat-val">{{ "%.1f"|format(stats.data_quality) }}%</span>
        </div>
    </div>
</div>

<!-- Main Content Grid -->
<div style="display: grid; grid-template-columns: 1fr; gap: 2rem;">
    <!-- Map Section -->
    <div class="glass">
        <div class="p-6"
            style="border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-between;">
            <h3 class="font-bold" style="display: flex; align-items: center; gap: 0.5rem;">
                <span style="width: 8px; height: 8px; background-color: var(--accent-red); border-radius: 50%;"
                    class="animate-pulse"></span>
                Live Outbreak Heatmap
            </h3>
            <button class="badge"
                style="background: transparent; cursor: pointer; color: var(--accent-blue); border: 1px solid var(--accent-blue);">Global
                View</button>
        </div>
        <div id="map" style="background-color: #0f172a;"></div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Initialize Map (Leaflet)
    document.addEventListener('DOMContentLoaded', () => {
        const map = L.map('map').setView([20, 0], 2);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy;OpenStreetMap, &copy;CartoDB',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);

        // Add mock outbreak markers
        L.circle([-14.235, -51.925], {
            color: 'red',
            fillColor: '#f03',
            fillOpacity: 0.5,
            radius: 500000
        }).addTo(map).bindPopup("<strong>High Risk: Dengue</strong><br>Brazil region");

        L.circle([20.593, 78.962], {
            color: 'orange',
            fillColor: '#f90',
            fillOpacity: 0.5,
            radius: 400000
        }).addTo(map).bindPopup("<strong>Medium Risk: Malaria</strong><br>India region");

        L.circle([-1.286, 36.817], {
            color: 'yellow',
            fillColor: '#ff0',
            fillOpacity: 0.3,
            radius: 300000
        }).addTo(map).bindPopup("<strong>Low Risk: Cholera</strong><br>Nairobi region");
    });
</script>
{% endblock %}